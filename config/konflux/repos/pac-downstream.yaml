name: pac-downstream
upstream: openshift-pipelines/pipelines-as-code
components:
  - name: controller
  - name: webhook
  - name: watcher
  - name: cli
    nudges:
      - operator-{{hyphenize .Version.Version}}-bundle
      - tektoncd-cli-{{hyphenize .Version.Version}}-tkn
patches: &patches
  - name: go1.23
    script: |
      rm ../.konflux/patches/0000-go1.23.patch || true
      sed -i "s%go1.24.*%go1.23%g" go.mod
      sed -i "s%go 1.23.8%go 1.23.6%g" vendor/modules.txt
      if [[ -z $(git status --porcelain --untracked-files=no) ]]; then
            echo "No change, exiting"
            exit 0
      else
        git diff > ../.konflux/patches/0000-go1.23.patch
      fi
      # clean after yourself >:D
      git checkout HEAD go.mod vendor/modules.txt
branches:
  - name: next
    upstream: release-v0.34.x
    patches: *patches
    versions:
      - next
